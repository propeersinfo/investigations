# -*- coding: utf-8 -*-

_tag_table =\
[
    [u'isaac shwartz'      , u'composer' , u'Isaac Shwartz'      , u'Исаак Шварц'       ],
    [u'70s'                , u'time'     , u'70\'s'              , u''                   ],
    [u'movie'              , u'misc'     , u''                   , u''                   ],
    [u'ye-ye'              , u'genre'    , u'yé-yé'              , u''                   ],
    [u'60s'                , u'time'     , u'60\'s'              , u''                   ],
    [u'funk'               , u'genre'    , u''                   , u''                   ],
    [u'armenia'            , u'region'   , u'armenia'            , u''                   ],
    [u'orchestra groove'   , u'genre'    , u'orchestra groove'   , u''                   ],
    [u'tukhmanov'          , u'composer' , u'David Tukhmanov'    , u'Давид Тухманов'     ],
    [u'vodograi'           , u'ensemble' , u'Vodograi'           , u'Водограй'           ],
    [u'dear boy'           , u'misc'     , u''                   , u''                   ],
    [u'psychedelic'        , u'genre'    , u''                   , u''                   ],
    [u'ensembles'          , u'misc'     , u''                   , u''                   ],
    [u'ukraine'            , u'region'   , u'ukraine'            , u''                   ],
    [u'veselye rebyata'    , u'ensemble' , u'Veselye Rebyata'    , u'ВИА Веселые ребята'     ],
    [u'poyushie serdca'    , u'ensemble' , u'Poyushie Serdtsa'   , u'ВИА Поюшие сердца'      ],
    [u'evgeny gevorgyan'   , u'composer' , u'Yevgeny Gevorgyan'  , u'Евгений Геворгян'   ],
    [u'sci-fi'             , u'misc'     , u''                   , u''                   ],
    [u'krylatov'           , u'composer' , u'Yevgeny Krylatov'   , u'Евгений Крылатов'   ],
    [u'motorcycle'         , u'misc'     , u''                   , u''                   ],
    [u'garanyan'           , u'jazz'     , u'Georgy Garanyan'    , u'Георгий Гаранян'    ],
    [u'azerbaijan'         , u'region'   , u'azerbaijan'         , u''                   ],
    [u'bulbuloglu'         , u'composer' , u'Polad Bülbüloğlu'   , u'Полад Бюль-бюль Оглы' ],
    [u'muslim magomayev'   , u'vocalist' , u'Muslim Magomayev'   , u'Муслим Магомаев'   ],
    [u'gradsky'            , u'ensemble' , u'Alexander Gradsky'  , u'Александр Градский' ],
    [u'best'               , u'misc'     , u''                   , u''                   ],
    [u'melodia'            , u'jazz'     , u'Melodiya'           , u'Ансамбль Мелодия'            ],
    [u'alexander zatsepin' , u'composer' , u'Alexander Zatsepin' , u'Александр Зацепин'  ],
    [u'aida vedisheva'     , u'vocalist' , u'Aida Vedisheva'     , u'Аида Ведишева'      ],
    [u'pop'                , u'genre'    , u''                   , u''                   ],
    [u'gennadiy gladkov'   , u'composer' , u'Gennadiy Gladkov'   , u'Геннадий Гладков'   ],
    [u'eurocrime'          , u'genre'    , u''                   , u''                   ],
    [u'disco'              , u'genre'    , u''                   , u''                   ],
    [u'avilov'             , u'ensemble' , u'Avilov\'s Rhythm'   , u'ВИА Ритм п/у Авилова'   ],
    [u'alla pugachova'     , u'vocalist' , u'Alla Pugachova'     , u'Алла Пугачёва'      ],
    [u'80s'                , u'time'     , u"80's"               , u''                   ],
    [u'soul'               , u'genre'    , u''                   , u''                   ],
    [u'plamya'             , u'ensemble' , u'Plamya'             , u'ВИА Пламя'              ],
    [u'igor nazaruk'       , u'jazz'     , u'Igor Nazaruk'       , u'Игорь Назарук'      ],
    [u'jazz-funk'          , u'genre'    , u''                   , u''                   ],
    [u'jazz'               , u'genre'    , u''                   , u''                   ],
    [u'imants kalnins'     , u'composer' , u'Imants Kalniņš'     , u'Имантс Калнынш'     ],
    [u'latvia'             , u'region'   , u'latvia'             , u''                   ],
    [u'edita pyekha'       , u'vocalist' , u'Edita Piekha'       , u'Эдита Пьеха'        ],
    [u'qaya'               , u'ensemble' , u'Qaya'               , u'Вокальный квартет Гая' ],
    [u'mix'                , u'misc'     , u''                   , u''                   ],
    [u'soulviet'           , u'misc'     , u''                   , u''                   ],
    [u'vasilkov'           , u'ensemble' , u'Vladimir Vasilkov'  , u'Владимир Васильков' ],
    [u'samotsveti'         , u'ensemble' , u'Samotsvety'         , u'Самоцветы'         ],
    [u'electron'           , u'ensemble' , u'Electron'           , u'Электрон'           ],
    [u'twist\'n\'beat'     , u'genre'    , u''                   , u''                   ],
    [u'konstantin orbelian', u'jazz'     , u'Konstantin Orbelyan', u'Константин Орбелян' ],
    [u'belarus'            , u'region'   , u'belarus'            , u''                   ],
    [u'verasy'             , u'ensemble' , u'Verasy'             , u'Верасы'            ],
    [u'raimonds pauls'     , u'composer' , u'Raimonds Pauls'     , u'Раймонд Паулс'     ],
    [u'library mood'       , u'genre'    , u'library mood'       , u''                   ],
    [u'jazz groove'        , u'genre'    , u''                   , u''                   ],
    [u'beat'               , u'genre'    , u''                   , u''                   ],
    [u'eolika'             , u'ensemble' , u'Eolika'             , u'Эолика'             ],
    [u'david goloschekin'  , u'jazz'     , u'David Goloschekin'  , u'Давид Голощекин'    ],
    [u'art-rock'           , u'genre'    , u''                   , u''                   ],
    [u'space funk'         , u'genre'    , u''                   , u''                   ],
    [u'zodiac'             , u'ensemble' , u'Zodiac'             , u'Зодиак'             ],
    [u'moldavia'           , u'region'   , u'moldavia'           , u''                   ],
    [u'maria codrianu'     , u'vocalist' , u'Maria Codrianu'     , u'Мария Кодриану'     ],
    [u'orizont'            , u'ensemble' , u'Orizont'            , u'Оризонт'            ],
    [u'happy euro'         , u'genre'    , u'happy euro'         , u''                   ],
    [u'golubye gitary'     , u'ensemble' , u'Golubye Gitary'     , u'Голубые Гитары'    ],
    [u'shake'              , u'genre'    , u''                   , u''                   ],
    [u'surf'               , u'genre'    , u''                   , u''                   ],
    [u'rock atelye'        , u'ensemble' , u'Rock Atelye'        , u'Рок-Ателье'        ],
    [u'all tracks'         , u'misc'     , u''                   , u''                   ],
    [u'info'               , u'misc'     , u''                   , u''                   ],
    [u'modo'               , u'ensemble' , u'Modo'               , u'Модо'               ],
    [u'dj jankie'          , u'modern'   , u'Jan-Kit'            , u''                   ],
    [u'estonia'            , u'region'   , u'estonia'            , u''                   ],
    [u'vitamiin'           , u'ensemble' , u'Vitamiin'           , u'Витамин'           ],
    [u'kazakhstan'         , u'region'   , u'kazakhstan'         , u''                   ],
    [u'dos-mukasan'        , u'ensemble' , u'Dos-Mukasan'        , u'Дос–Мукасан'        ],
    [u'garage'             , u'genre'    , u''                   , u''                   ],
    [u'georgia'            , u'region'   , u'georgia'            , u''                   ],
    [u'disco band'         , u'ensemble' , u'Disco Band'         , u'Оркестр и вокальная группа Диско'         ],
    [u'links'              , u'misc'     , u''                   , u''                   ],
    [u'vdokhnovenie'       , u'ensemble' , u'Vdokhnovenie'       , u'Вдохновенье'        ],
    [u'iveriya'            , u'ensemble' , u'Iveriya'            , u'Иверия'             ],
    [u'boris rychkov'      , u'composer' , u'Boris Rychkov'      , u'Борис Рычков'       ],
    [u'poyushie-gitary'    , u'ensemble' , u'Poyushie Gitary'    , u'Поюшие Гитары'     ],
    [u'uzbekistan'         , u'region'   , u'uzbekistan'         , u''                   ],
    [u'big beat'           , u'genre'    , u''                   , u''                   ],
    [u'easy'               , u'genre'    , u''                   , u''                   ],
    [u'electronica'        , u'genre'    , u''                   , u''                   ],
    [u'electro'            , u'genre'    , u''                   , u''                   ],
    [u'igor brill'         , u'jazz'     , u'Igor Brill'         , u'Игорь Бриль'         ],
    [u'rybnikov'           , u'composer' , u'Alexey Rybnikov'    , u'Алексей Рыбников'    ],
    [u'rock'               , u'genre'    , u''                   , u''                   ],
    [u'my'                 , u'misc'     , u''                   , u''                   ],
    [u'foreign'            , u'region'   , u''                   , u''                   ],
    [u'pakhmutova'         , u'composer' , u'Alexandra Pakhmutova', u'Александра Пахмутова'],
    [u'musical'            , u'genre'    , u''                   , u''                   ],
    [u'lithuania'          , u'region'   , u'lithuania'          , u''                   ],
    [u'kuprevicius'        , u'composer' , u'Giedrius Kuprevicius', u'Гедриус Купревичус'],
    [u'vainshtein'         , u'jazz'     , u'Iosif Weinstein'    , u'Иосиф Вайнштейн'    ],
    [u'uno naissoo'        , u'composer' , u'Uno Naissoo'        , u'Уно Наиссоо'        ],
    [u'fix'                , u'ensemble' , u'Fix'                , u'Фикс'                ],
    [u'syabry'             , u'ensemble' , u'Syabry'             , u'Сябры'              ],
    [u'progressive'        , u'genre'    , u''                   , u''                   ],
    [u'ambient'            , u'genre'    , u''                   , u''                   ],
    [u'gladkov'            , u'composer' , u'Gennady Gladkov'    , u'Геннадий Гладков'   ],
    [u'composers'          , u'misc'     , u''                   , u''                   ],
    [u'jazz-rock'          , u'genre'    , u''                   , u''                   ],
    [u'75'                 , u'ensemble' , u'75'                 , u'ВИА 75'             ],
    [u'sovremennik'        , u'jazz'     , u'Sovremennik'        , u'Ансамбль Современник п/у Анатолия Кролла'        ],
    [u'sampling'           , u'misc'     , u''                   , u''                   ],
    [u'vigners'            , u'jazz'     , u'Ivars Vigners'      , u'Иварс Вигнерс'      ],
    [u'groove'             , u'genre'    , u''                   , u''                   ],
    [u'eln'                , u'modern'   , u'ELN'                , u''                   ],
    [u'orera'              , u'ensemble' , u'Orera'              , u'Орэра'              ],
    [u'blues'              , u'genre'    , u''                   , u''                   ],
    [u'folk'               , u'genre'    , u''                   , u''                   ],
    [u'pesnyary'           , u'ensemble' , u'Pesnyary'           , u'Песняры'            ],
    [u'groove beats'       , u'genre'    , u''                   , u''                   ],
    [u'oktava'             , u'ensemble' , u'Oktava'             , u'Октава'             ],
    [u'theatre'            , u'genre'    , u''                   , u''                   ],
    [u'tonis magi'         , u'vocalist' , u'Tõnis Mägi'         , u'Тынис Мяги'         ],
    [u'orchestra'          , u'genre'    , u''                   , u''                   ],
    [u'saulsky'            , u'composer' , u'Yuri Saulsky'       , u'Юрий Саульский'     ],
    [u'azerbayjan'         , u'region'   , u'azerbayjan'         , u''                   ],
    [u'babayev'            , u'jazz'     , u'Rafiq Babayev'      , u'Рафик Бабаев'       ],
    [u'boomerang'          , u'jazz'     , u'Boomerang'          , u'Бумеранг'           ],
    [u'dustar'             , u'jazz'     , u'Dustar'             , u'Дустар'             ],
    [u'jaan-kuman'         , u'jazz'     , u'Jaan Kuman'         , u'Яан Куман'         ],
    [u'saarsalu'           , u'jazz'     , u'Lembit Saarsalu'    , u'Лембит Саарсалу'    ],
    [u'reggae'             , u'genre'    , u''                   , u''                   ],
    [u'bossa'              , u'genre'    , u''                   , u''                   ],
    [u'ludvikovsky'        , u'jazz'     , u'Vadim Ludvikovsky'  , u'Оркестр п/у Вадима Людвиковского' ],
    [u'my-rip'             , u'misc'     , u''                   , u''                   ],
    [u'bboybreaks'         , u'genre'    , u''                   , u''                   ],
    [u'ariel'              , u'ensemble' , u'Ariel'              , u'Ариэль'             ],
    [u'tajikistan'         , u'region'   , u'Tajikistan'         , u''                   ],
    [u'jaan kuman'         , u'jazz'     , u'Jaan Kuman'         , u'Яан Куман'          ],
    [u'kyrgyzstan'         , u'region'   , u'kyrgyzstan'         , u''                   ],
    [u'moldova'            , u'region'   , u'moldova'            , u''                   ],
    [u'russia'             , u'region'   , u'russia'             , u''                   ],
    [u'melodiya'           , u'jazz'     , u'Melodiya'           , u'Ансамбль Мелодия'            ],
    [u'kuman'              , u'jazz'     , u'Jaan Kuman'         , u'Яан Куман'          ],
    [u'turkmenistan'       , u'region'   , u'turkmenistan'       , u''                   ],
    [u'garanian'           , u'jazz'     , u'Georgy Garanyan'    , u'Георгий Гаранян'     ],
    
    [u'katenin'           , u'composer'     , u'Alexander Katenin'     , u''     ],
    [u'tengiz'            , u'modern'       , u'TenDJiz'               , u''     ],
    [u'video'             , u'misc'         , u''                      , u''     ],
    [u'mr-and-7'          , u'modern'       , u'Mr. And-7'             , u''     ],
    [u'jazz-78'           , u'series'       , u'Jazz-78'               , u'Джаз-78'     ],
    [u'tantsurutme'       , u'series'       , u'Tantsurütme 7"s'       , u'Танцевальные ритмы'     ],
    [u'arsenal'           , u'jazz'         , u'Arsenal'               , u''     ],
    [u'estradines-melodijos'  , u'ensemble' , u'Estradinės Melodijos'  , u''     ],
    [u'gazizov'           , u'composer'     , u'Robert Gazizov'        , u''     ],
    [u'recognize'         , u'misc'         , u''                      , u''     ],
    [u'modern'            , u'misc'         , u''                      , u''     ],
    [u'ojakaar'           , u'composer'     , u'Valter Ojakäär'        , u'Вальтер Оякяэр'     ],
    [u'dielo'             , u'ensemble'     , u'Dielo'                 , u''     ],
    [u'weedska'           , u'modern'       , u'Weedska'               , u''     ],
    [u'kuut'              , u'vocalist'     , u'Marju Kuut'            , u'Марью Куут'     ],
    [u'jazz-fusion'       , u'genre'        , u''                      , u''     ],
    [u'jazz-comfort'      , u'jazz'         , u'Jazz Comfort'          , u''     ],
    [u'straume'           , u'jazz'         , u'Egils Straume'         , u'Эгилс Страуме'     ],
    [u'paulus'            , u'jazz'         , u'Tiit Paulus'           , u''     ],
    [u'steady-rock'       , u'modern'       , u'Steady Rock'           , u''     ],
    [u'yan-shrimp'        , u'modern'       , u'Yan Shrimp'            , u''     ],
    [u'morozov'           , u'ensemble'     , u'Yuri Morozov'          , u'Юрий Морозов'     ],
    [u'sato'              , u'jazz'         , u'Sato'                  , u'Сато'     ],
    [u'spoken'            , u'misc'         , u''                      , u''     ],
    [u'psycho'            , u'ensemble'     , u'Psycho'                , u'Психо'     ],
    [u'joala'             , u'vocalist'     , u'Jaak Joala'            , u'Яак Йоала'     ],
    [u'laine'             , u'ensemble'     , u'Laine'                 , u'Эстрадный ансамбль Лайне'     ],
    [u'allegro'           , u'jazz'         , u'Allegro'                 , u'Аллегро'     ],
    
]

from operaimport.tag_rewrite import rewrite_tag

class dict_of_lists(dict):
    def __init__(self):
        super(dict_of_lists, self).__init__()
    def append(self, key, value):
        if self.has_key(key):
            assert isinstance(self[key], list)
            self[key].append(value)
        else:
            self[key] = [ value ]


tag_info_by_tag_name = dict()
tag_info_by_category = dict_of_lists()
for row in _tag_table:
    name = original_name = row[0]
    assert name
    name = rewrite_tag(name)
    cat = row[1]
    assert cat
    title = row[2]
    if not title: title = name
    title_ru = row[3]
    tag_info = {
        'name':     name,
        'category': cat,
        'title':    title,
        'title_ru': title_ru
    }
    #print 'names: "%s" => "%s"' % (original_name, name)

    if not tag_info_by_tag_name.has_key(name):
        #assert not tag_info_by_tag_name.has_key(name), 'duplicate definition for tag %s, prob. because of %s' % (name, original_name)
        #if name == 'shake':
        #    print 'setting for tag %s' % name
        tag_info_by_tag_name[name] = tag_info
        tag_info_by_category.append(tag_info['category'], tag_info)
        #if tag_info_by_category.has_key(cat):
        #    tag_info_by_category[cat].append(tag_info)
        #else:
        #    tag_info_by_category[cat] = [tag_info ]

# return hash category_name -> tag_info
def get_used_tags_categories():
    tags_by_cat = dict()
    uncategorized = []

    from gen_static import BlogMeta

    blog_meta = BlogMeta.instance()
    for tag_name in blog_meta.articles_by_tags.keys():
        #tag_name = rewrite_tag(tag_name)
        tag_info = tag_info_by_tag_name.get(tag_name)
        if tag_info:
            cat = tag_info['category']
            if tags_by_cat.has_key(cat):
                tags_by_cat[cat].append(tag_info)
            else:
                tags_by_cat[cat] = [ tag_info ]
        else:
            #raise Exception('tag_name not categorized: %s' % (tag_name,))
            uncategorized.append(tag_name)

    return tags_by_cat, uncategorized

def get_region_tags():
    tags = list()
    for row in _tag_table:
        if row[1] == 'region':
            tags.append(row[0])
    return list(set(tags))

def get_tag_for_related_articles(tag_names):
    for cat in [ 'series', 'ensemble', 'jazz', 'composer', 'vocalist', 'modern', 'genre' ]:
        tag_names_2 = [ ti['name'] for ti in tag_info_by_category[cat] ]
        intersection = list(set(tag_names) & set(tag_names_2))
        if len(intersection):
            return intersection[0]
    return None

def get_about_text(tag_name):
    tag_info = tag_info_by_tag_name.get(tag_name, None)
    if tag_info:
        def_abouts = {
            'composer': '%s is a soviet composer.',
            'vocalist': '%s is a soviet singer.',
            'series':   '%s is a series of vinyl records released at Melodiya.'
        }
        about = def_abouts.get(tag_info['category'], None)
        if about:
            title = tag_info['title']
            if tag_info.has_key('title_ru') and tag_info['title_ru']:
                title = '%s (%s)' % (tag_info['title'], tag_info['title_ru'])
            return about % title
    return None

if __name__ == '__main__':
    print 'rewriting tag data...'

    column_names = [ 'tag', 'category', 'title', 'title_ru' ]
    column_names_by_offset = dict()
    for offset, cn in enumerate(column_names):
        column_names_by_offset[offset] = cn

    _tag_table.sort(key=lambda row: row[1])

    #cats = dict()
    #for row in _tag_table:


    for row in _tag_table:
        print '{'
        new_column_order = [ 1, 0, 2, 3 ]
        for offset in new_column_order:
            property_name = column_names_by_offset[offset]
            property_value = row[offset]
            if property_value:
                #print type(property_name), type(property_value)
                pn_quoted = '"%s"' % property_name
                print u'  %-10s : "%s",' % (pn_quoted, property_value)
        print '},'